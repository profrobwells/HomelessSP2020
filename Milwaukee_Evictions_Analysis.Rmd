---
title: "Wisconsin Evictions Analysis"
author: "Rob Wells"
date: "7/21/2020"
output: html_document
---

# Analyzing Eviction Court Data From Milwaukee
### Data analysis by Rob Wells


- **The records come from this website**  
https://wcca.wicourts.gov/advanced.html 

--------------------------------------------------------------------
- **Part 1: Load Libraries and Data**

```{r include=FALSE}
library(tidyverse)
library(janitor)
library(lubridate)
library(kableExtra)
```
Load Data for Evictions tab
```{r}
july <- rio::import("https://docs.google.com/spreadsheets/d/1RaY8T3ZZb8q0hv8l9eW0Etey8LVlF97AF4a0rEo5khg/edit?pli=1#gid=357722399", which = "July") 
```
Load Data for Evictions tab
```{r}
june <- rio::import("https://docs.google.com/spreadsheets/d/1RaY8T3ZZb8q0hv8l9eW0Etey8LVlF97AF4a0rEo5khg/edit?pli=1#gid=0", which = "June") 
```
Load Data for Evictions tab
```{r}
may <- rio::import("https://docs.google.com/spreadsheets/d/1RaY8T3ZZb8q0hv8l9eW0Etey8LVlF97AF4a0rEo5khg/edit?pli=1#gid=1496576271", which = "May") 
```
Load Data for Evictions tab
```{r}
april <- rio::import("https://docs.google.com/spreadsheets/d/1RaY8T3ZZb8q0hv8l9eW0Etey8LVlF97AF4a0rEo5khg/edit?pli=1#gid=573768668", which = "April") 
```

Load Data for Evictions tab
```{r}
march <- rio::import("https://docs.google.com/spreadsheets/d/1RaY8T3ZZb8q0hv8l9eW0Etey8LVlF97AF4a0rEo5khg/edit?pli=1#gid=1672355376", which = "March") 
```

Load Data for Evictions tab
```{r}
feb <- rio::import("https://docs.google.com/spreadsheets/d/1RaY8T3ZZb8q0hv8l9eW0Etey8LVlF97AF4a0rEo5khg/edit?pli=1#gid=251485342", which = "February") 
```

Load Data for Evictions tab
```{r}
jan <- rio::import("https://docs.google.com/spreadsheets/d/1RaY8T3ZZb8q0hv8l9eW0Etey8LVlF97AF4a0rEo5khg/edit?pli=1#gid=2098662943", which = "January") 
```

Combine into single df: 9,500 cases July 6
```{r}
evict <- rbind(jan, feb, march, april, may, june, july)
```


- **Clean names**
```{r}
evict <- janitor::clean_names(evict)
```
- **Check data fields**
```{r}
glimpse(evict)
```
- **Process dates** 
```{r}
#Process dates
evict$date <- mdy(evict$filing_date)
evict$year <- year(evict$date)
```

```{r}
evict <- evict %>% 
  mutate(yearmon = format(date, "%Y-%m"))
```

### Total Eviction Filings by Month in Wisconsin
**Wisconsin eviction moratorium was March 27 - May 27, 2020**
```{r}
z <- evict %>% 
  group_by(yearmon) %>%
  count(yearmon)
z
```

- **Chart of Wisconsin Eviction Filings in 2020**  
**Wisconsin eviction moratorium was March 27 - May 27, 2020**
```{r}

ggplot(z, aes(x=yearmon, y=n, fill=yearmon)) +
  geom_col() +
  labs(title="Wisconsin Eviction Filings Per Month",y="Evictions", x= "", 
       caption = "Graphic by Rob Wells. 7-6-2020", subtitle = "Source: Wisconsin Circuit Court records")+
  theme(legend.position="none") 
ggsave("Wisc_Evict_7_6_2020.png",device = "png",width=9,height=6, dpi=500)
```

-- **Evictions by County**
```{r}
x <- evict %>% 
  group_by(county_name) %>%
  count(county_name) %>% 
  arrange(desc(n))
head(x)
```

-- **Milwaukee Subset: 4384 records**
```{r}
milw <- evict %>% 
  filter(county_name == "Milwaukee")
```


-- **Milwaukee Eviction Filings by Month**   
**Wisconsin eviction moratorium was March 27 - May 27, 2020**   
```{r}
milw %>% 
  group_by(yearmon) %>%
  count(yearmon)

```

-- **Chart Milwaukee Eviction Filings by Month**    
**Wisconsin eviction moratorium was March 27 - May 27, 2020**    
```{r}
milw %>% 
  group_by(yearmon) %>%
  count(yearmon) %>% 
  ggplot(aes(x=yearmon, y=n, fill=yearmon)) +
  geom_col() +
  labs(title="Milwaukee Evictions Filings Per Month", y="Evictions", x= "", 
       caption = "Graphic by Rob Wells. 7-6-2020", subtitle = "Source: Wisconsin Circuit Court records")+
  theme(legend.position="none") 
ggsave("Milw_Evict_7_6_2020.png",device = "png",width=9,height=6, dpi=500)
```
- **Check data fields**
```{r}
glimpse(milw)
```

-- **Parse Plaintiffs - Defendants in Milwaukee**
```{r}
milw$parties <- milw$caption

p <- separate(data = milw, col = caption, into = c("plaintiff", "defendant"), sep = " vs. ", extra = "merge", fill = "right")

head(p)

write.csv(p, "milwevictions.7.6.2020.csv")
```

-- **Clean the columns - remove stray spaces**

```{r}
p$plaintiff <- str_trim(p$plaintiff)
p$defendant <- str_trim(p$defendant)
p$plaintiff <- gsub("[[:punct:]]", "", p$plaintiff)
p$defendant <- gsub("[[:punct:]]", "", p$defendant)
head(p)
#x$plaintiff <- gsub(" ", "_", x$plaintiff)
```

-- **Summary of Milwaukee Plaintiffs **
```{r}
#Build a simple summary table
plaintiff1 <- p %>% 
  select(plaintiff, defendant, date) %>% 
         group_by(plaintiff) %>% 
         count(plaintiff) %>% 
         ungroup() %>% 
         arrange(desc(n))

write.csv(plaintiff1, "milplaintiff.7.6.2020.csv")


plaintiff1
```

--**Radical Cleaning of Plaintiffs**
#split data into two columns

```{r}
p2 <- p

p2$plaintiff_fixed <- p2$plaintiff
```


```{r}
glimpse(p2)
```




```{r}
p2$plaintiff_fixed <- str_remove(str_replace_all(str_remove(p2$plaintiff_fixed, "^.*\\n"), "\\n", " "), "\\|.*")
```

```{r}
p2$plaintiff_fixed <- str_trim(p2$plaintiff_fixed)
p2$plaintiff_fixed <- tolower(p2$plaintiff_fixed)
```

--**Substitute top names and normalize**
```{r}
p2 <- p2 %>% 
  mutate(plaintiff_fixed = case_when(plaintiff=="Michael S Wisniewski" ~ "michael_s_wisniewski",
                                     plaintiff=="Daniel W Bruckner" ~ "daniel_w_bruckner",
                                     plaintiff=="Gregory W Nawrocki" ~ "gregory_w_nawrocki",
                                     plaintiff=="Gregory Nawrocki" ~ "gregory_w_nawrocki",
                                     plaintiff=="Gragory W Nawrocki" ~ "gregory_w_nawrocki",
                                     plaintiff=="Gregory W Nawriocki" ~ "gregory_w_nawrocki",
                                     plaintiff=="Bruce Martin" ~ "bruce_martin",
                                     plaintiff=="Housing Authority of the City of Milwaukee" ~ "milwaukee_city_housing_authority",
                                     plaintiff=="City of Milwaukee" ~ "milwaukee_city",
                                     plaintiff=="City  of Milwaukee" ~ "milwaukee_city",
                                     plaintiff=="Paul E. Hurst, C/O Berrada Properties" ~ "berrada",
                                     plaintiff=="Milwaukee Living LLC" ~ "milwaukee_living",
                                     plaintiff=="Milwaukee Capital Properties" ~ "milwaukee_capital",
                                     plaintiff=="Good Hope Townhomes" ~ "good_hope_townhomes",
                                     plaintiff=="Howard and 76th Street Holding Company" ~ "howard_76_st_holding_co",
                                      plaintiff=="Robert J Maas" ~ "robert_maas",
                                    TRUE~plaintiff)) 

```

--**split names**
```{r}
p2 <- separate(data = p2, col = plaintiff_fixed, into = c("plaintiff", "plaintiff2", "plaintiff3"), sep = " ", extra = "merge", fill = "right")
```


--**quick total**
-- **Radical Cleaning - Summary of Milwaukee Plaintiffs **
```{r}
#Build a simple summary table
plaintiff2 <- p2 %>% 
  select(plaintiff, defendant, date) %>% 
         group_by(plaintiff) %>% 
         count(plaintiff) %>% 
         ungroup() %>% 
         arrange(desc(n))

write.csv(plaintiff2, "milplaintiff.7.21.2020.csv")
```

--**Top with top 50 Results of Milwaukee Landlords**
```{r}
plaintiff2 %>% 
  top_n(50, n) %>% 
  kable() %>% 
  kable_styling("striped")

```

--**Note Milwaukee and the city housing authority together have 47 evictions **


-- **Radically cleaned summary of Milwaukee Plaintiffs since March 27 2020**
```{r}
p2 %>% 
  filter(date > '2020-03-27') %>% 
  select(plaintiff, defendant, date) %>% 
         group_by(plaintiff) %>% 
         count(plaintiff) %>% 
         ungroup() %>% 
         arrange(desc(n))

#write.csv(plaintiff1, "milplaintiff.7.6.2020.csv")

```

-- **Summary of Milwaukee Defendants **
```{r}
defendants <- p %>% 
  select(plaintiff, defendant, date) %>% 
         group_by(defendant) %>% 
         count(defendant) %>% 
         ungroup() %>% 
         arrange(desc(n))
defendants
```

--**Load PPP data**
```{r}
ppp <- rio::import("/Users/rswells/Dropbox/Current_Projects/Eviction - Covid Summer 2020/PPP Data/150k plus/foia_150k_plus.xlsx") 
```

```{r}
wiscppp <- ppp %>% 
  filter(State=="WI")
```

```{r}
glimpse(wiscppp)
```
```{r}
glimpse(p)
```


--**30**
